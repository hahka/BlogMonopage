<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="UTF-8"/>
    <meta name="google-signin-scope" content="profile email">
    <meta name="google-signin-client_id" content="307924988327-h49vh3j6j8cseikbmbkednksmjbrm9b1.apps.googleusercontent.com">
    <script src="https://apis.google.com/js/platform.js" async defer></script>

    <link rel="stylesheet" href="css/normalize.css" />
    <link rel="stylesheet" href="css/foundation.min.css" />
    <link rel="stylesheet" href="css/app.css" />

    <title>MonoBlog</title>

    <script src="js/jquery-2.1.4.min.js"></script>
    <script src="js/authentication.js"></script>
    <script>
        $(document).ready(
                function () {
                    console.log("ready");

                    $.ajax({
                        url: "posts",
                        method: "GET",
                        success: function (data) {
                            //console.log(data);
                            $("main").html(data);
                        }
                    });


                    $("#add_post_button").click(
                            function () {
                                console.log("click");

                                $.ajax({
                                    url: "newpost",
                                    method: "GET",
                                    success: function (data) {
                                        console.log(data);

                                        $("main").html(data);
                                    }
                                });
                            }
                    )

                }

        );


    </script>

</head>


<body>

<header>Index du blog</header>

<section id="user_info">
    <div class="g-signin2" data-onsuccess="onSignIn" data-theme="dark"></div>
</section>

<div class="button" id="add_post_button">Ajouter un nouveau post</div>

<main>


</main>

<footer></footer>

<script>
    function onSignIn(googleUser) {
        // Useful data for your client-side scripts:
        var profile = googleUser.getBasicProfile();
        /*console.log("ID: " + profile.getId()); // Don't send this directly to your server!
        console.log("Name: " + profile.getName());
        console.log("Image URL: " + profile.getImageUrl());
        console.log("Email: " + profile.getEmail());*/

        // The ID token you need to pass to your backend:
        var id_token = googleUser.getAuthResponse().id_token;

        //console.log(googleUser.getAuthResponse());

        //console.log("ID Token: " + id_token);

        $.ajax({
            url: "https://www.googleapis.com/oauth2/v3/tokeninfo?id_token="+id_token,
            //url: "https://www.googleapis.com/oauth2/v3/tokeninfo?id_token=ubkbb",
            method: "GET",
            success: function(data){
                if (verifyAuthentication(data))
                    console.log(" - User connected - ");
                else
                    googleUser.disconnect();


                //googleUser.disconnect();
                //console.log(data);
                //console.log(data.email);
                //console.log(data.aud);
                //$("main").html(data);
            },
            error: function(XMLHttpRequest, textStatus, errorThrown) {
                //console.log("Status: " + textStatus);
                //console.log("Error: " + errorThrown);
            }
        });

        //googleUser.disconnect();
        // appID : 307924988327
    };


</script>


</body>
</html>

